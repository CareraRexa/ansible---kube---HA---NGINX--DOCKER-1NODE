global
    log /dev/log local0
    log /dev/log local1 notice
    maxconn 4096
    user haproxy
    group haproxy
    daemon

defaults
    log global
    mode http
    option httplog
    option dontlognull
    option forwardfor
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

# Stats monitoring
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE
    stats auth admin:password123

# HTTP Frontend (no SSL)
frontend http_frontend
    bind *:80
    default_backend react_backend

# Backend to Kubernetes
backend react_backend
    balance roundrobin
    option httpchk GET /
    http-check expect status 200
    server k8s-master 192.168.95.135:30080 check inter 3000 rise 2 fall 3 maxconn 1000

# ====================================================================
# UNCOMMENT SECTION BELOW WHEN YOU HAVE A DOMAIN
# ====================================================================
# 
# # HTTPS Frontend (with SSL)
# frontend https_frontend
#     bind *:443 ssl crt /etc/ssl/private/haproxy-ssl.pem
#     default_backend react_backend
#     http-response set-header Strict-Transport-Security "max-age=31536000"
#     http-response set-header X-Frame-Options "SAMEORIGIN"
#     http-response set-header X-Content-Type-Options "nosniff"
# 
# # Redirect HTTP to HTTPS
# frontend http_frontend
#     bind *:80
#     http-request redirect scheme https code 301 if !{ ssl_fc }
